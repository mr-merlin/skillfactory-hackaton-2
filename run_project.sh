#!/bin/bash

echo "üöó –ó–ê–ü–£–°–ö –ü–†–û–ï–ö–¢–ê –°–ë–ï–†–ê–í–¢–û–ü–û–î–ü–ò–°–ö–ê"
echo "=================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
if [ ! -d "venv" ]; then
    echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
    python3 -m venv venv
fi

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
echo "üîß –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
source venv/bin/activate

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
if ! python -c "import pandas, numpy, matplotlib, seaborn, sklearn, flask" 2>/dev/null; then
    echo "üìö –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
    pip install -r requirements.txt
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö
if [ ! -f "data/ga_sessions.pkl" ] || [ ! -f "data/ga_hits.pkl" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –§–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –ø–∞–ø–∫–µ data/"
    echo "–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª—ã ga_sessions.pkl –∏ ga_hits.pkl –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ data/"
    exit 1
fi

echo ""
echo "üéØ –í–´–ë–ï–†–ò–¢–ï –î–ï–ô–°–¢–í–ò–ï:"
echo "1. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏"
echo "2. –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞"
echo "3. –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (Jupyter Notebook)"
echo "4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏"
echo "5. –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞"
echo "6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Jupyter Notebook"
echo "7. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤"
echo "8. –í—ã—Ö–æ–¥"

read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1-8): " choice

case $choice in
    1)
        echo ""
        echo "ü§ñ –û–ë–£–ß–ï–ù–ò–ï –ú–û–î–ï–õ–ò..."
        echo "===================="
        cd code && python sber_auto_model.py && cd ..
        ;;
    2)
        echo ""
        echo "üåê –ó–ê–ü–£–°–ö API –°–ï–†–í–ï–†–ê..."
        echo "======================="
        if [ ! -f "build/sber_auto_model.pkl" ]; then
            echo "‚ö†Ô∏è –ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –°–Ω–∞—á–∞–ª–∞ –æ–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª—å (–æ–ø—Ü–∏—è 1)"
            exit 1
        fi
        echo "üöÄ –ó–∞–ø—É—Å–∫ API –Ω–∞ http://localhost:5001"
        cd code && python api.py && cd ..
        ;;
    3)
        echo ""
        echo "üìä –ó–ê–ü–£–°–ö JUPYTER NOTEBOOK..."
        echo "============================="
        if ! python -c "import jupyter" 2>/dev/null; then
            echo "üìö –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Jupyter..."
            pip install jupyter
        fi
        echo "üìñ –ó–∞–ø—É—Å–∫ Jupyter Notebook..."
        jupyter notebook analysis_report.ipynb
        ;;
    4)
        echo ""
        echo "üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ú–û–î–ï–õ–ò..."
        echo "========================="
        if [ ! -f "build/sber_auto_model.pkl" ]; then
            echo "‚ö†Ô∏è –ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –°–Ω–∞—á–∞–ª–∞ –æ–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª—å (–æ–ø—Ü–∏—è 1)"
            exit 1
        fi
        echo "üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏..."
        cd tests && python test_model.py && cd ..
        ;;
    5)
        echo ""
        echo "üß™ –ü–û–õ–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê..."
        echo "================================="
        cd tests && python test_project.py && cd ..
        ;;
    6)
        echo ""
        echo "üìä –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï JUPYTER NOTEBOOK..."
        echo "==================================="
        cd tests && python test_notebook.py && cd ..
        ;;
    7)
        echo ""
        echo "üéØ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ó–ê–ü–†–û–°–û–í –ö –ú–û–î–ï–õ–ò..."
        echo "===================================="
        if [ ! -f "build/sber_auto_model.pkl" ]; then
            echo "‚ö†Ô∏è –ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –°–Ω–∞—á–∞–ª–∞ –æ–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª—å (–æ–ø—Ü–∏—è 1)"
            exit 1
        fi
        echo "üöÄ –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤..."
        cd example && python demo_queries.py && cd ..
        ;;
    8)
        echo "üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!"
        exit 0
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
        exit 1
        ;;
esac

echo ""
echo "‚úÖ –û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
